var utils=function(exports){var adjustImgShape=(container,ratio)=>{document.querySelectorAll(container+" .img-wrap img").forEach(img=>{img.onload=()=>{img.parentNode.classList.add(img.naturalWidth/img.naturalHeight>=ratio?"img-w":"img-h")}})},connectWS=option=>{console.log(`Connecting to ${option.uri} ...`);const ws=new WebSocket(option.uri);return ws.onopen=ev=>{console.log("RTServer Connection Created!"),option.type&&ws.send(JSON.stringify({type:option.type,data:"Set Request Type"})),option.host&&ws.send(JSON.stringify({type:option.type,data:option.host}))},ws.onmessage=ev=>{option.receive(ev.data)},ws.onclose=ev=>{console.log("RTServer Connection Closed!")},ws.onerror=ev=>{throw console.log("RTServer Connection Broken!"),new Error(ev)},ws},convertTableDataToString=data=>{if(!data.headers||!data.rows)throw new ReferenceError("数据源格式不正确");let str="",body=[];return data.headers.forEach(head=>{body.push(head.title)}),str+=body.join(",")+"\n",body=[],data.rows.forEach(row=>{data.headers.forEach(head=>{let x=""+row[head.prop];body.push(x.includes(",")?`"${x}"`:x)}),str+=body.join(",")+"\n",body=[]}),str},config={errorMsg:{101:"该用户已存在",102:"验证码错误",103:"验证码已过期",104:"用户名或密码错误",105:"用户未登录",106:"用户已登录，请刷新页面",107:"原密码错误",108:"无效的邮箱地址",109:"无效的手机号",110:"无效的用户名",111:"邮箱地址未绑定",112:"手机号未绑定",113:"用户登录失败次数大于4次，已被锁定，请1小时后再试",114:"用户权限不足",115:"验证失败次数过多，请重新发送验证码",116:"邮箱地址已绑定",117:"手机号已绑定",200:"请求超时",201:"请求发送失败",202:"后台服务未启动",203:"系统错误",204:"对象不存在",205:"请求过于频繁",206:"非法参数",207:"必选参数不能为空",208:"签名不匹配",209:"非开放API",210:"数据解析失败",211:"要存储的对象超过了大小限制",212:"API请求次数超过限制",213:"创建对象失败",214:"查询对象失败",215:"更新对象失败",216:"删除对象失败",217:"对象已存在"},errorStatusMsg:{403:"拒绝访问",404:"API不存在",405:"请求方法不允许",500:"内部服务器发生错误",502:"后台服务未启动",504:"请求超时，请重试"}};const wrapFetch=function(request){let status=200;return new Promise((resolve,reject)=>{fetch(request).then(res=>{if(res.ok)return res.json();throw{status:status=res.status,msg:config.errorStatusMsg[res.status]||res}}).then(body=>{if(0!==body.code)throw{status:status,code:body.code,msg:config.errorMsg[body.code]||body.msg||body.error||"Unknown Error"};resolve(body.data)}).catch(reject)})};let urlPrefix="/api",CSRFHeader="X-CSRFToken",CSRFValue="csrf";const requestUrl=function(url){return url.startsWith("/")||url.startsWith("http")?url:`${urlPrefix}/${url}`};var $fetch={prefix(prefix){urlPrefix=prefix},setCSRF(header,value){CSRFHeader=header,CSRFValue=value},get:url=>wrapFetch(new Request(requestUrl(url),{credentials:"same-origin",headers:{Accept:"application/json","x-access-token":localStorage.token}})),post:(url,params)=>wrapFetch(new Request(requestUrl(url),{method:"post",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","x-access-token":localStorage.token,[CSRFHeader]:sessionStorage[CSRFValue]},body:JSON.stringify(params)})),form:(url,params)=>wrapFetch(new Request(requestUrl(url),{method:"post",credentials:"same-origin",headers:{Accept:"application/json","x-access-token":localStorage.token,[CSRFHeader]:sessionStorage[CSRFValue]},body:params})),put:(url,params)=>wrapFetch(new Request(requestUrl(url),{method:"put",credentials:"same-origin",headers:{Accept:"application/json","Content-Type":"application/json","x-access-token":localStorage.token,[CSRFHeader]:sessionStorage[CSRFValue]},body:JSON.stringify(params)})),putForm:(url,params)=>wrapFetch(new Request(requestUrl(url),{method:"put",credentials:"same-origin",headers:{Accept:"application/json","x-access-token":localStorage.token,[CSRFHeader]:sessionStorage[CSRFValue]},body:params})),delete:url=>wrapFetch(new Request(requestUrl(url),{method:"delete",credentials:"same-origin",headers:{Accept:"application/json","x-access-token":localStorage.token,[CSRFHeader]:sessionStorage[CSRFValue]}}))},fillDateNumber=value=>value<10?`0${value}`:value,formatDate=(date,type)=>{let year=date.getFullYear(),month=date.getMonth()+1,day=date.getDate(),hour=date.getHours(),minute=date.getMinutes(),second=date.getSeconds();switch(type){case"YYYY-M-D":case 1:return`${year}-${month}-${day}`;case"YYYYMMDD":case 2:return Number(`${year}${fillDateNumber(month)}${fillDateNumber(day)}`);case 3:return`${year}年${month}月${day}日 ${hour}:${minute}:${second}`;case"YYYY-MM-DD":case 4:return`${year}-${fillDateNumber(month)}-${fillDateNumber(day)}`;case"YYYY-M-D h:m:s":return`${year}-${month}-${day} ${hour%12}:${minute}:${second}`;case"YYYY-M-D H:m:s":return`${year}-${month}-${day} ${hour}:${minute}:${second}`;case"YYYY-MM-DD HH:mm:ss":return`${year}-${fillDateNumber(month)}-${fillDateNumber(day)} ${fillDateNumber(hour)}:${fillDateNumber(minute)}:${fillDateNumber(second)}`;case"YYYY-MM-DD hh:mm:ss":return`${year}-${fillDateNumber(month)}-${fillDateNumber(day)} ${fillDateNumber(hour%12)}:${fillDateNumber(minute)}:${fillDateNumber(second)}`;default:return`${year}-${month}-${day} ${hour}:${minute}:${second}`}},getAverageRGB=imgEl=>{let data,width,height,length,defaultRGB={r:0,g:0,b:0},canvas=document.createElement("canvas"),context=canvas.getContext&&canvas.getContext("2d"),i=-4,rgb={r:0,g:0,b:0},count=0;if(!context)return defaultRGB;height=canvas.height=imgEl.naturalHeight||imgEl.offsetHeight||imgEl.height,width=canvas.width=imgEl.naturalWidth||imgEl.offsetWidth||imgEl.width,context.drawImage(imgEl,0,0);try{data=context.getImageData(0,0,width,height)}catch(e){return defaultRGB}for(length=data.data.length;(i+=20)<length;)++count,rgb.r+=data.data[i],rgb.g+=data.data[i+1],rgb.b+=data.data[i+2];return rgb.r=~~(rgb.r/count),rgb.g=~~(rgb.g/count),rgb.b=~~(rgb.b/count),rgb};function getElemHeight(el){const elStyle=getComputedStyle(el),elDisplay=elStyle.display,elPosition=elStyle.position,elVisibility=elStyle.visibility;if("none"!==elDisplay)return el.offsetHeight;el.style.position="absolute",el.style.visibility="hidden",el.style.display="block";const elHeight=el.offsetHeight;return el.style.display=elDisplay,el.style.position=elPosition,el.style.visibility=elVisibility,elHeight}var getKeyByValue=(obj,value)=>{for(let key in obj)if(obj[key]===value)return key},getScrollTop=()=>document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,getSearchParam=name=>{const searchString=new URL(location).search;if("URLSearchParams"in window){return new URLSearchParams(searchString).get(name)}const params={};return searchString.substring(1).split("&").forEach(pair=>{pair=pair.split("="),params[pair[0]]=pair[1]}),params[name]},getTimeDiff=time=>{const d=new Date;let diff=Math.floor(d.getTime()/1e3)-time,thisDate=new Date(1e3*time),thisYear=thisDate.getFullYear(),thisMonth=thisDate.getMonth()+1,thisDay=thisDate.getDate(),thisHour=thisDate.getHours(),thisMinute=thisDate.getMinutes();return thisHour=0===thisHour?"00":thisHour,thisMinute=0===thisMinute?"00":thisMinute,diff<60?`${diff<1?1:diff}秒前`:diff>=60&&diff<3600?`${Math.floor(diff/60)}分钟前`:thisDate.toDateString()===d.toDateString()?`今天 ${thisHour}:${thisMinute}`:thisYear===d.getFullYear()?`${thisMonth}月${thisDay}日 ${thisHour}:${thisMinute}`:`${thisYear}-${thisMonth}-${thisDay} ${thisHour}:${thisMinute}`},getype=value=>{let type=Object.prototype.toString.call(value);return"[object Undefined]"===type?"undefined":"[object Null]"===type?"null":"[object Number]"===type?"number":"[object String]"===type?"string":"[object Array]"===type?"array":"[object Object]"===type?"object":"[object Function]"===type?"function":"[object Boolean]"===type?"boolean":"[object Date]"===type?"date":"[object Error]"===type?"error":"[object RegExp]"===type?"regexp":void 0},isEmptyObject=obj=>{if("object"!==getype(obj))throw new TypeError(`${obj} 不是对象字面量`);return!Object.keys(obj).length},isFirefox=()=>/Firefox/i.test(navigator.userAgent),isIE=()=>/Trident/i.test(navigator.userAgent),isMobile=()=>/Mobi/i.test(navigator.userAgent),isMobileEx=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isSupportWebGL=()=>{const canvas=document.createElement("canvas"),supports="probablySupportsContext"in canvas?"probablySupportsContext":"supportsContext";return supports in canvas?canvas[supports]("webgl")||canvas[supports]("experimental-webgl"):"WebGLRenderingContext"in window},isWeixin=()=>{return navigator.userAgent.toLowerCase().match(/micromessenger/)},isWeixinInIphone=()=>{let userAgent=navigator.userAgent.toLowerCase();return userAgent.match(/iphone os/)&&userAgent.match(/micromessenger/)},reload=()=>{isWeixin()?location.href=location.href+"?v="+1e4*Math.random():location.reload()},saveDataToFile=(data,filename,ext)=>{let blob=new Blob(["\ufeff"+data],{type:`text/${ext};charset=utf-8`}),url=URL.createObjectURL(blob),link=document.createElement("a");link.setAttribute("href",url),link.setAttribute("download",`${filename}.${ext}`),document.body.appendChild(link),link.click(),document.body.removeChild(link)},smoothToTop=()=>{pageYOffset>500&&scroll(0,500);let y=-pageYOffset/15,t=setInterval(()=>{0!==pageYOffset?scrollBy(0,y):clearInterval(t)},15)},sortObjectArray=(arr,column,dir=1)=>(arr.sort((a,b)=>"number"==typeof a[column]?dir>0?a[column]-b[column]:b[column]-a[column]:new Intl.Collator({sensitivity:"base"}).compare(dir>0?a[column]:b[column],dir>0?b[column]:a[column])),arr),sleep=(ms=1e3)=>new Promise((resolve,reject)=>{setTimeout(()=>resolve(),ms)}),browserType=()=>{const ua=navigator.userAgent;let browser=ua.match(/Edge\/([\d.]+)/i);return browser?"edge":(browser=ua.match(/Firefox\/([\d.]+)/i))?"firefox":(browser=ua.match(/Version\/([\d.]+)/i))?"safari":(browser=ua.match(/Chrome\/([\d.]+)/i))?"chrome":void 0},intlNumber=value=>"undefined"==typeof Intl?value:void 0===value?0:new Intl.NumberFormat(void 0,{maximumFractionDigits:6}).format(value),generateQueryString=obj=>{let str="";for(let k in obj)str+=`&${k}=${obj[k]}`;return str.substring(1)},getNumberArray=(min,max)=>new Array(max-min+1).fill(0).map((v,i)=>min+i),secondsToDuration=(num,type=1)=>{if(num<=0)return"";let days=0,hours=0,minutes=0,seconds=0;return 0===(minutes=Math.trunc(num/60))?[`00:00:${seconds=fillDateNumber(num)}`,`${seconds}s`][type-1]:(seconds=fillDateNumber(num%60),0===(hours=Math.trunc(minutes/60))?[`00:${minutes=fillDateNumber(minutes)}:${seconds}`,`${minutes}m${seconds}s`][type-1]:(minutes=fillDateNumber(minutes%60),0===(days=Math.trunc(hours/24))?[`${hours=fillDateNumber(hours)}:${minutes}:${seconds}`,`${hours}h${minutes}m${seconds}s`][type-1]:[`${days}天 ${hours=fillDateNumber(hours%24)}:${minutes}:${seconds}`,`${days}day${hours}h${minutes}m${seconds}s`][type-1]))},kvAry2Obj=ary=>ary.reduce((obj,[key,value])=>({...obj,[key]:value}),{}),utils={adjustImgShape:adjustImgShape,connectWS:connectWS,convertTableDataToString:convertTableDataToString,fetch:$fetch,fillDateNumber:fillDateNumber,formatDate:formatDate,getAverageRGB:getAverageRGB,getElemHeight:getElemHeight,getKeyByValue:getKeyByValue,getScrollTop:getScrollTop,getSearchParam:getSearchParam,getTimeDiff:getTimeDiff,getype:getype,isEmptyObject:isEmptyObject,isFirefox:isFirefox,isIE:isIE,isMobile:isMobile,isMobileEx:isMobileEx,isSupportWebGL:isSupportWebGL,isWeixin:isWeixin,isWeixinInIphone:isWeixinInIphone,reload:reload,saveDataToFile:saveDataToFile,smoothToTop:smoothToTop,sortObjectArray:sortObjectArray,sleep:sleep,browserType:browserType,intlNumber:intlNumber,generateQueryString:generateQueryString,getNumberArray:getNumberArray,secondsToDuration:secondsToDuration,kvAry2Obj:kvAry2Obj,intDate2Dashed:date=>date?`${date}`.replace(/^(\d{4})(\d{2})(\d{2})$/,(function(x,a,b,c){return`${a}-${b}-${c}`})):date,dashedDate2Int:date=>Number(date.replace(/-/g,""))};return exports.$fetch=$fetch,exports.adjustImgShape=adjustImgShape,exports.browserType=browserType,exports.connectWS=connectWS,exports.convertTableDataToString=convertTableDataToString,exports.default=utils,exports.fillDateNumber=fillDateNumber,exports.formatDate=formatDate,exports.generateQueryString=generateQueryString,exports.getAverageRGB=getAverageRGB,exports.getElemHeight=getElemHeight,exports.getKeyByValue=getKeyByValue,exports.getNumberArray=getNumberArray,exports.getScrollTop=getScrollTop,exports.getSearchParam=getSearchParam,exports.getTimeDiff=getTimeDiff,exports.getype=getype,exports.intlNumber=intlNumber,exports.isEmptyObject=isEmptyObject,exports.isFirefox=isFirefox,exports.isIE=isIE,exports.isMobile=isMobile,exports.isMobileEx=isMobileEx,exports.isSupportWebGL=isSupportWebGL,exports.isWeixin=isWeixin,exports.isWeixinInIphone=isWeixinInIphone,exports.kvAry2Obj=kvAry2Obj,exports.reload=reload,exports.saveDataToFile=saveDataToFile,exports.secondsToDuration=secondsToDuration,exports.sleep=sleep,exports.smoothToTop=smoothToTop,exports.sortObjectArray=sortObjectArray,exports}({});